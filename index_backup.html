<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bâtiments Culturels de Caen</title>

    <!-- CDN MaplibreGL JS -->
    <script src="https://unpkg.com/maplibre-gl@^5.5.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@^5.5.0/dist/maplibre-gl.css" rel="stylesheet" />
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }
        .control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .title {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .toggle-container label {
            margin-left: 5px;
        }
        .popup-content {
            max-width: 300px;
        }
        .popup-content h3 {
            margin-top: 0;
            margin-bottom: 5px;
        }
        .popup-content p {
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="control-panel">
        <div class="title">Bâtiments Culturels de Caen</div>
        <div class="toggle-container">
            <input type="checkbox" id="toggle-buildings" checked>
            <label for="toggle-buildings">Afficher les bâtiments culturels</label>
        </div>
    </div>

    <script>
        // Coordonnées du centre de Caen (Place Saint-Sauveur)
        const caenCenter = [-.36, 49.183];
        
        // Liste des bâtiments culturels de Caen avec leurs coordonnées et descriptions
        const culturalBuildings = [
            {
                id: 1,
                name: "Château de Caen",
                coordinates: [-.36305, 49.18639],
                description: "Forteresse médiévale du XIe siècle qui abrite le musée de Normandie et le musée des Beaux-Arts de Caen."
            },
            {
                id: 2,
                name: "Abbaye aux Hommes",
                coordinates: [-.37076, 49.18277],
                description: "Abbaye bénédictine fondée par Guillaume le Conquérant au XIe siècle, aujourd'hui l'Hôtel de Ville de Caen."
            },
            {
                id: 3,
                name: "Abbaye aux Dames",
                coordinates: [-.35431, 49.18944],
                description: "Abbaye bénédictine fondée par Mathilde de Flandre au XIe siècle, siège du Conseil Régional de Normandie."
            },
            {
                id: 4,
                name: "Mémorial de Caen",
                coordinates: [-.38941, 49.19778],
                description: "Musée et mémorial consacré à la Seconde Guerre mondiale et à la Bataille de Normandie."
            },
            {
                id: 5,
                name: "Théâtre de Caen",
                coordinates: [-.36534, 49.18243],
                description: "Principal théâtre de la ville offrant une programmation variée d'opéras, ballets et concerts."
            },
            {
                id: 6,
                name: "Le Dôme",
                coordinates: [-.36198, 49.17963],
                description: "Centre culturel et scientifique proposant des expositions interactives et ateliers pédagogiques."
            },
            {
                id: 7,
                name: "Église Saint-Pierre",
                coordinates: [-.36040, 49.18267],
                description: "Église gothique flamboyant du XIIIe siècle avec sa tour-lanterne caractéristique."
            },
            {
                id: 8,
                name: "FRAC Normandie",
                coordinates: [-.35843, 49.17753],
                description: "Fonds Régional d'Art Contemporain présentant des expositions d'art contemporain."
            },
            {
                id: 9,
                name: "Artothèque de Caen",
                coordinates: [-.36196, 49.18369],
                description: "Espace d'exposition dédié à l'art contemporain, proposant également un service de prêt d'œuvres."
            }
        ];

        // Initialisation de la carte
        const map = new maplibregl.Map({
            container: 'map',
            style: 'https://tiles.stadiamaps.com/styles/alidade_smooth/style.json',
            center: caenCenter,
            zoom: 14,
            minZoom: 12, // Empêche de trop dézoomer
            maxBounds: [ // Limite les mouvements autour de Caen
                [-.45, 49.13],
                [-.27, 49.23]
            ]
        });

        // Création d'une source de données pour les bâtiments
        map.on('load', function() {
            // Ajouter la source de données GeoJSON
            map.addSource('buildings', {
                type: 'geojson',
                data: {
                    type: 'FeatureCollection',
                    features: culturalBuildings.map(building => {
                        return {
                            type: 'Feature',
                            properties: {
                                id: building.id,
                                name: building.name,
                                description: building.description
                            },
                            geometry: {
                                type: 'Point',
                                coordinates: building.coordinates
                            }
                        };
                    })
                }
            });

            // Ajouter une couche pour afficher les bâtiments (cercles)
            map.addLayer({
                id: 'buildings-layer',
                type: 'circle',
                source: 'buildings',
                paint: {
                    'circle-radius': 8,
                    'circle-color': '#E63946',
                    'circle-stroke-width': 2,
                    'circle-stroke-color': 'white'
                }
            });

            // Ajouter une couche pour les noms des bâtiments
            map.addLayer({
                id: 'buildings-labels',
                type: 'symbol',
                source: 'buildings',
                layout: {
                    'text-field': ['get', 'name'],
                    'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
                    'text-size': 12,
                    'text-offset': [0, 1.5],
                    'text-anchor': 'top'
                },
                paint: {
                    'text-color': '#1D3557',
                    'text-halo-color': 'white',
                    'text-halo-width': 1
                }
            });

            // Gérer le clic sur un bâtiment pour afficher les informations
            map.on('click', 'buildings-layer', function(e) {
                const properties = e.features[0].properties;
                const coordinates = e.features[0].geometry.coordinates.slice();
                
                // Créer le contenu du popup
                const popupContent = `
                    <div class="popup-content">
                        <h3>${properties.name}</h3>
                        <p>${properties.description}</p>
                    </div>
                `;
                
                // Créer et afficher le popup
                new maplibregl.Popup()
                    .setLngLat(coordinates)
                    .setHTML(popupContent)
                    .addTo(map);
            });

            // Changer le curseur quand on survole un bâtiment
            map.on('mouseenter', 'buildings-layer', function() {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'buildings-layer', function() {
                map.getCanvas().style.cursor = '';
            });

            // Gérer l'affichage/masquage des bâtiments
            document.getElementById('toggle-buildings').addEventListener('change', function(e) {
                const visibility = e.target.checked ? 'visible' : 'none';
                map.setLayoutProperty('buildings-layer', 'visibility', visibility);
                map.setLayoutProperty('buildings-labels', 'visibility', visibility);
            });
        });
    </script>
</body>
</html>